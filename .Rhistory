beta1=1
beta2=2
d <- data.frame(
id = 1:n,
z  = data_matrix[ , 1],
x  = data_matrix[ , 2]) %>%
mutate(
y = beta0 + (beta1 * z) + (beta2 * x) + rnorm(n=n)
)
d
head(d)
rm(list = ls())
library(dplyr)
library(ggplot2)
library(MASS)
library(progress)
## this supposes a true model that is:
## y ~ \beta_{0} + \beta_{1}z_{i} + \beta_{2}x_{x} + \epsilon_{i}
##
## and an actually estimated model that is:
## y ~ \tilde{\beta}_{0} + \tilde{\beta}_{1}z_{i} + \tilde{epsilon}_{i}
omitted_variables_bias <- function(
n=100, beta0=0, beta1=1, beta2=2, cov_z_x=0,
long_or_short=c('long', 'short')) {
require(dplyr)
require(MASS)
variance_covariance_matrix <- matrix(
data = c(2, cov_z_x, cov_z_x, 2),
nrow = 2, ncol = 2, byrow = TRUE
)
data_matrix <- mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
d <- data.frame(
id = 1:n,
z  = data_matrix[ , 1],
x  = data_matrix[ , 2]) %>%
mutate(
y = beta0 + (beta1 * z) + (beta2 * x) + rnorm(n=n)
)
if(length(long_or_short) == 2) {
stop('Pick `long_or_short` to be either "long" or "short!"')
} else if(long_or_short == 'long') {
model <- lm(y ~ z + x, data = d)
} else if(long_or_short == 'short') {
model <- lm(y ~ z, data = d)
}
return(model)
}
omitted_variables_bias(long_or_short = 'long')
omitted_variables_bias(long_or_short = 'long')
omitted_variables_bias(long_or_short = 'long')
simulation <- function(long_or_short='long', cov_z_x=0) {
estimated_results <- rep(NA, 1000)
pb <- progress_bar$new(total = 1000)
for(i in 1:1000) {
estimated_results[i] <- coef(omitted_variables_bias(cov_z_x = cov_z_x, long_or_short = long_or_short))['z']
pb$tick()
}
ggplot() +
aes(x = estimated_results) +
geom_histogram(bins = 30)
}
## 1. Estimate the long model, with no covariance between z and x
simulation(long_or_short = 'long', cov_z_x = 0)
## 2. Estimate the short model, with no covariance between z and x
simulation(long_or_short = 'short', cov_z_x = 0)
## 2. Estimate the short model, with no covariance between z and x
simulation(long_or_short = 'short', cov_z_x = 0)
simulation(long_or_short = 'long', cov_z_x = .1)
## 4. Estimate the short model, with 0.1 covariance between z and x
simulation(long_or_short = 'short', cov_z_x = .1)
simulation(long_or_short = 'long', cov_z_x = .9)
simulation(long_or_short = 'short', cov_z_x = .9)
simulation <- function(long_or_short='long', cov_z_x=0, beta2=2) {
estimated_results <- rep(NA, 1000)
pb <- progress_bar$new(total = 1000)
for(i in 1:1000) {
estimated_results[i] <- coef(omitted_variables_bias(cov_z_x = cov_z_x, long_or_short = long_or_short, beta2=beta2))['z']
pb$tick()
}
ggplot() +
aes(x = estimated_results) +
geom_histogram(bins = 30)
}
simulation(long_or_short = 'long', cov_z_x = .9, beta2 = 10)
## 8. Estimate the short model with 0.1 covariance between z and x, but with `beta2=10`
simulation(long_or_short = 'short', cov_z_x = .9, beta2 = 10)
rm(list = ls())
cov_z_x = 0
variance_covariance_matrix <- matrix(
data = c(2, cov_z_x, cov_z_x, 2),
nrow = 2, ncol = 2, byrow = TRUE
)
variance_covariance_matrix
n=n
n=100
mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
data_matrix <- mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
cov(data_matrix[,1], data_matrix[,2])
cov_z_x = 1
variance_covariance_matrix <- matrix(
data = c(2, cov_z_x, cov_z_x, 2),
nrow = 2, ncol = 2, byrow = TRUE
)
data_matrix <- mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
cov(data_matrix[,1], data_matrix[,2])
library(dplyr)
library(ggplot2)
library(MASS)
library(progress)
## this supposes a true model that is:
## y ~ \beta_{0} + \beta_{1}z_{i} + \beta_{2}x_{x} + \epsilon_{i}
##
## and an actually estimated model that is:
## y ~ \tilde{\beta}_{0} + \tilde{\beta}_{1}z_{i} + \tilde{epsilon}_{i}
omitted_variables_bias <- function(
n=100, beta0=0, beta1=1, beta2=2, cov_z_x=0,
long_or_short=c('long', 'short')) {
require(dplyr)
require(MASS)
variance_covariance_matrix <- matrix(
data = c(2, cov_z_x, cov_z_x, 2),
nrow = 2, ncol = 2, byrow = TRUE
)
data_matrix <- mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
d <- data.frame(
id = 1:n,
z  = data_matrix[ , 1],
x  = data_matrix[ , 2]) %>%
mutate(
y = beta0 + (beta1 * z) + (beta2 * x) + rnorm(n=n)
)
if(length(long_or_short) == 2) {
stop('Pick `long_or_short` to be either "long" or "short!"')
} else if(long_or_short == 'long') {
model <- lm(y ~ z + x, data = d)
} else if(long_or_short == 'short') {
model <- lm(y ~ z, data = d)
}
return(model)
}
library(dplyr)
library(ggplot2)
library(MASS)
library(progress)
omitted_variables_bias <- function(
n=100, beta0=0, beta1=1, beta2=2, cov_z_x=0,
long_or_short=c('long', 'short')) {
require(dplyr)
require(MASS)
variance_covariance_matrix <- matrix(
data = c(2, cov_z_x, cov_z_x, 2),
nrow = 2, ncol = 2, byrow = TRUE
)
data_matrix <- mvrnorm(n=n, mu=c(0, 0), Sigma=variance_covariance_matrix)
d <- data.frame(
id = 1:n,
z  = data_matrix[ , 1],
x  = data_matrix[ , 2]) %>%
mutate(
y = beta0 + (beta1 * z) + (beta2 * x) + rnorm(n=n)
)
if(length(long_or_short) == 2) {
stop('Pick `long_or_short` to be either "long" or "short!"')
} else if(long_or_short == 'long') {
model <- lm(y ~ z + x, data = d)
} else if(long_or_short == 'short') {
model <- lm(y ~ z, data = d)
}
return(model)
}
View(omitted_variables_bias)
omitted_variables_bias(n=100, long_or_short = 'long')
omitted_variables_bias(n=100, long_or_short = 'long')
omitted_variables_bias(n=100, long_or_short = 'long')
omitted_variables_bias(n=100, long_or_short = 'long')
omitted_variables_bias(n=100, long_or_short = 'long')
omitted_variables_bias(n=100, long_or_short = 'long')
simulation <- function(long_or_short='long', cov_z_x=0, beta2=2) {
estimated_results <- rep(NA, 1000)
pb <- progress_bar$new(total = 1000)
for(i in 1:1000) {
estimated_results[i] <- coef(omitted_variables_bias(cov_z_x = cov_z_x, long_or_short = long_or_short, beta2=beta2))['z']
pb$tick()
}
ggplot() +
aes(x = estimated_results) +
geom_histogram(bins = 30)
}
## 1. Estimate the long model, with no covariance between z and x
omitted_variables_bias(cov_z_x = 0, long_or_short = 'short')
## 1. Estimate the long model, with no covariance between z and x
omitted_variables_bias(cov_z_x = 0, long_or_short = 'long')
simulation(long_or_short = 'long', cov_z_x = 0)
simulation(long_or_short = 'short', cov_z_x = 0)
simulation(long_or_short = 'long', cov_z_x = 0.1)
simulation(long_or_short = 'short', cov_z_x = 0.1)
simulation <- function(long_or_short='long', cov_z_x=0, beta2=2) {
estimated_results <- rep(NA, 1000)
pb <- progress_bar$new(total = 1000)
for(i in 1:1000) {
estimated_results[i] <- coef(omitted_variables_bias(cov_z_x = cov_z_x, long_or_short = long_or_short, beta2=beta2))['z']
pb$tick()
}
ggplot() +
aes(x = estimated_results) +
geom_histogram(bins = 30) +
coord_cartesian(xlim = c(0, 2))
}
simulation(long_or_short = 'long', cov_z_x = 0.1)
## 4. Estimate the short model, with 0.1 covariance between z and x
simulation(long_or_short = 'short', cov_z_x = 0.1)
simulation <- function(long_or_short='long', cov_z_x=0, beta2=2) {
estimated_results <- rep(NA, 1000)
pb <- progress_bar$new(total = 1000)
for(i in 1:1000) {
estimated_results[i] <- coef(omitted_variables_bias(cov_z_x = cov_z_x, long_or_short = long_or_short, beta2=beta2))['z']
pb$tick()
}
ggplot() +
aes(x = estimated_results) +
geom_histogram(bins = 30)
}
simulation(long_or_short = 'long', cov_z_x = 0.5)
simulation(long_or_short = 'short', cov_z_x = 0.1, beta2 = 10)
simulation(long_or_short = 'short', cov_z_x = 0.5, beta2 = 10)
d <- data.table::fread('~/Downloads/Batch_4616774_batch_results.csv')
d
View(d)
View(d)
d <- data.table::fread('~/Downloads/cps_00001.csv')
d
d[ , table(VOREG)]
d[ , table(VOREG, useNA = TRUE)]
d[ , table(VOREG, useNA)]
?table
d[ , table(VOREG, useNA = 'always')]
LETTERS[1:10]
d <- data.table(
group = sample(LETTERS[1:10], size = 100, replace = TRUE),
treat = sample(c('control', 'treatment'), size = 100, replace = TRUE)
)
d[ , y := 1 + 2 * I(treat == 'treatment') + 3 * I(group == 'A') + rnorm(n=100)]
d <- data.table(
group = sample(LETTERS[1:10], size = 100, replace = TRUE),
treat = sample(c('control', 'treatment'), size = 100, replace = TRUE)
)
d <- data.table::data.table(
group = sample(LETTERS[1:10], size = 100, replace = TRUE),
treat = sample(c('control', 'treatment'), size = 100, replace = TRUE)
)
d[ , y := 1 + 2 * I(treat == 'treatment') + 3 * I(group == 'A') + rnorm(n=100)]
not_saturated_model <- d[ , lm(y ~ factor(treat) + factor(group) + factor(treat)*factor(group))]
summary(not_saturated)
summary(not_saturated_model)
stargazer::stargazer(
not_saturated_model, saturated_model,
type = 'text'
)
saturated_model <- d[ , lm(y ~ -1 + factor(treat) + factor(group) + factor(treat)*factor(group))]
stargazer::stargazer(
not_saturated_model, saturated_model,
type = 'text'
)
stargazer::stargazer(
not_saturated_model, saturated_model,
type = 'text',
omit.stat = c('rse', 'F')
)
stargazer::stargazer(
not_saturated_model, saturated_model,
type = 'text',
omit.stat = c('ser', 'F')
)
getwd()
setwd('~/MIDS/w241/mids-w241-live-session/')
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
make_simple_data <- function(size=100) {
require(data.table)
d <- data.table(id = 1:100)
d[ , y0 := runif(.N, min = 0, max = 1)]
d[ , y1 := y0 + .25]
return(d)
}
make_simple_data(size=100)
make_simple_data(size=100)
f <- make_simple_data()
f
print(f)
d[ , experimental_assignment := sample(0:1, size = .N, replace = TRUE)]
d[ , observational_selection := ifelse(y0 < .33, 1, 0)]
make_simple_data <- function(size=100) {
require(data.table)
d <- data.table(id = 1:100)
d[ , y0 := runif(.N, min = 0, max = 1)]
d[ , y1 := y0 + .25]
return(d)
}
d <- make_simple_data(size=100)
d[ , experimental_assignment := sample(0:1, size = .N, replace = TRUE)]
d[ , observational_selection := ifelse(y0 < .33, 1, 0)]
d[ , plot(y0, y0, pch = 1)]
d[ , points(y0, y1, pch = 2)]
library(ggplot2)
d
ggplot(data=d) +
aes(x = id, y = y0, color = 'blue')
ggplot(data=d) +
aes(x = id, y = y0, color = 'blue') +
geom_point()
ggplot(data=d) +
geom_point(aes(x = id, y = y0) color = 'blue')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'blue')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue')
ggplot(data=d) +
geom_point(aes(x = id, y = y0)) +
geom_point(aes(x = id, y = y1))
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange')
?geom_segment()
?arrow
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange')
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1,
arrow = 'last'
))
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1,
arrow = 'last'
))
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1,
ends = 'last'
))
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), color = 'grey40')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = 'last', color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = TRUE, color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last'), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last', length = unit(0.025, "inches")), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last', length = unit(0.01, "inches")), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last', length = unit(0.1, "inches")), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last', length = unit(0.1, "inches"), type = 'closed'), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(aes(
x = id, xend = id,
y = y0, yend = y1
), arrow = arrow(ends = 'last', length = unit(0.05, "inches"), type = 'closed'), color = 'grey70')
ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange') +
geom_segment(
aes(x = id, xend = id, y = y0, yend = y1),
arrow = arrow(ends = 'last', length = unit(0.05, "inches"), type = 'closed'),
color = 'grey70'
)
first_plot <- ggplot(data=d) +
geom_point(aes(x = id, y = y0), color = 'steelblue') +
geom_point(aes(x = id, y = y1), color = 'darkorange')
first_plot
first_plot +
geom_segment(
aes(x = id, xend = id, y = y0, yend = y1),
arrow = arrow(ends = 'last', length = unit(0.05, "inches"), type = 'closed'),
color = 'grey70'
)
?aes
?geom_point
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = I(1 - d)))
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = 1-d))
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = 1-experimental_assignment))
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, color = 'steelblue', size = 1-experimental_assignment))
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = 1-experimental_assignment), color = 'steelblue')
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = 1 - experimental_assignment), color = 'steelblue')
geom_point(aes(x = id, y = y1, size = experimental_assignment - 1), color = 'darkorange')
second_plot
second_plot <- ggplot(data = d) +
geom_point(aes(x = id, y = y0, size = 1 - experimental_assignment), color = 'steelblue') +
geom_point(aes(x = id, y = y1, size = experimental_assignment - 1), color = 'darkorange')
second_plot
second_plot +
geom_hline(yintercept = mean(d[experimental_assignment==0, y0]), color = 'steelblue')
second_plot +
geom_hline(yintercept = mean(d[experimental_assignment==0, y0]), color = 'steelblue') +
geom_hline(yintercept = mean(d[experimental_assignment==1, y1]), color = 'steelblue')
second_plot +
geom_hline(yintercept = mean(d[experimental_assignment==0, y0]), color = 'steelblue') +
geom_hline(yintercept = mean(d[experimental_assignment==1, y1]), color = 'darkorange')
?geom_hline
third_plot +
geom_hline(yintercept = mean(d[, y0]), color = 'steelblue', linetype = 2) +
geom_hline(yintercept = mean(d[, y1]), color = 'darkorange', linetype = 2)
third_plot <- second_plot +
geom_hline(yintercept = mean(d[experimental_assignment==0, y0]), color = 'steelblue') +
geom_hline(yintercept = mean(d[experimental_assignment==1, y1]), color = 'darkorange')
third_plot
third_plot +
geom_hline(yintercept = mean(d[, y0]), color = 'steelblue', linetype = 2) +
geom_hline(yintercept = mean(d[, y1]), color = 'darkorange', linetype = 2)
third_plot <- second_plot +
geom_hline(yintercept = mean(d[experimental_assignment==0, y0]), color = 'steelblue', linetype = 2) +
geom_hline(yintercept = mean(d[experimental_assignment==1, y1]), color = 'darkorange', linetype = 2)
third_plot
third_plot +
geom_hline(yintercept = mean(d[, y0]), color = 'steelblue', linetype = 1) +
geom_hline(yintercept = mean(d[, y1]), color = 'darkorange', linetype = 1)
print(d)
selection_plot <- ggplot(d) +
geom_point(aes(x = id, y = y0, size = 1-observational_selection), color = 'steelblue')
selection_plot
selection_plot <- ggplot(d) +
geom_point(aes(x = id, y = y0, size = 1 - observational_selection), color = 'steelblue') +
geom_point(aes(x = id, y = y1, size = observational_selection - 1), color = 'darkorange') +
geom_hline(yintercept = d[observational_selection == 0, mean(y0)], color = 'steelblue', linetype = 2) +
geom_hline(yintercept = d[observational_selection == 1, mean(y1)], color = 'darkorange', linetype = 2) +
geom_hline(yintercept = mean(d[, y0]), color = 'steelblue', linetype = 1) +
geom_hline(yintercept = mean(d[, y1]), color = 'darkorange', linetype = 1)
selection_plot <- ggplot(d) +
geom_point(aes(x = id, y = y0, size = 1 - observational_selection), color = 'steelblue') +
geom_point(aes(x = id, y = y1, size = observational_selection - 1), color = 'darkorange') +
geom_hline(yintercept = d[observational_selection == 0, mean(y0)], color = 'steelblue', linetype = 2) +
geom_hline(yintercept = d[observational_selection == 1, mean(y1)], color = 'darkorange', linetype = 2) +
geom_hline(yintercept = mean(d[, y0]), color = 'steelblue', linetype = 1) +
geom_hline(yintercept = mean(d[, y1]), color = 'darkorange', linetype = 1)
selection_plot
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
bookdown::render_book(clean = TRUE)
