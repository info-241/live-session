earnings_by_lottery <- ggplot(d) +
aes(x = earnings, fill = as.factor(lottery)) +
geom_density(alpha = 0.5)
earnings_by_lottery
set.seed(2)
d <- data.table(id = 1:1000)
## These are all independent of one another.
d[ , ':='(
ability       = rnorm(.N, mean=10, sd=1),
family_income = rnorm(.N, mean=20, sd=2),
lottery       = rnorm(.N, mean=10, sd=1) > 10 ## Win if larger than 10
)]
## Create a schooling indicator. This has the following characteristics:
##   - It is related to winning the lottery (which was random)
##   - It is related to ability
##   - It has some "white noise" just so that the model will estimate.
d[ , schooling := 1.0 * lottery + ability + rnorm(.N, mean=0, sd=1)]
## Create the outcome, which might be earnings. This has the following characteristics:
##   - It is affected by schooling (Yay!)
##   - It is affected by ability (Yay!)
##   - It is affected by family income :|
d[ , earnings := 2 * schooling + ability + family_income +  rnorm(.N, mean=0, sd=1)]
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat:= predict(first_stage)]
d[ , schooling_10 := schooling > 10]
# d[ , mean(ability), by = .(schooling_10)]
# d[ , mean(ability), by = .(schooling_hat)]
# d[ , mean(ability), by = .(lottery)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
coeftest(second_stage, vcov. = vcovHC)
d[ , residuals := resid(first_stage)]
earnings_by_lottery <- ggplot(d) +
aes(x = earnings, fill = as.factor(lottery)) +
geom_density(alpha = 0.5)
earnings_by_lottery
earnings_by_ability <- earnings_by_lottery <- ggplot(d) +
aes(y = earnings, x = ability) +
geom_point()
earnings_by_ability
earnings_by_ability <- earnings_by_lottery <- ggplot(d) +
aes(y = earnings, x = ability, color = as.factor(lottery)) +
geom_point()
earnings_by_ability
earnings_by_family_income <-
ggplot(d) +
aes(y = earnings, x = family_income, color = as.factor(lottery)) +
geom_point()
earnings_by_lottery / earnings_by_ability / earnings_by_family_income
ability_by_lottery <- ggplot(d) +
aes(x = ability, fill = as.factor(lottery)) +
geom_density(alpha = 0.5) +
labs(title = 'Ability by lottery')
residuals_lottery <- ggplot(d) +
aes(x = residuals, fill = as.factor(lottery)) +
geom_density(alpha = 0.5) +
labs(title = 'Residuals by lottery')
residuals_ability <- ggplot(d) +
aes(x = residuals, fill = as.factor(ability > 10)) +
geom_density(alpha = 0.5) +
labs(title = 'Residuals by ability')
ability_by_lottery / residuals_lottery / residuals_ability
residuals_lottery <- ggplot(d) +
aes(x = residuals, fill = as.factor(lottery)) +
geom_density(alpha = 0.5) +
labs(title = 'Residuals by lottery')
residuals_ability <- ggplot(d) +
aes(x = residuals, fill = as.factor(ability > 10)) +
geom_density(alpha = 0.5) +
labs(title = 'Residuals by ability')
residuals_lottery / residuals_ability
predicted_lottery <- ggplot(d) +
aes(x=as.factor(lottery), y=schooling_hat) +
geom_jitter() +
labs(title='Predicted Values and Lottery Winning')
predicted_ability <- ggplot(d) +
aes(x=ability, y=schooling_hat, color = as.factor(lottery)) +
geom_jitter() +
labs(title='Predicted Values and Ability')
predicted_lottery / predicted_ability
predicted_lottery <- ggplot(d) +
aes(x = as.factor(lottery), y = schooling_hat) +
geom_jitter() +
labs(title = 'Predicted Values and Lottery Winning')
predicted_ability <- ggplot(d) +
aes(x = ability, y = schooling_hat, color = as.factor(lottery)) +
geom_jitter() +
labs(title = 'Predicted Values and Ability')
predicted_lottery / predicted_ability
make_iv_data <- function(instrument_strength=1.0) {
set.seed(2)
d <- data.table(id = 1:1000)
## These are all independent of one another.
d[ , ':='(
ability       = rnorm(.N, mean=10, sd=1),
family_income = rnorm(.N, mean=20, sd=2),
lottery       = rnorm(.N, mean=10, sd=1) > 10 ## Win if larger than 10
)]
## Create a schooling indicator. This has the following characteristics:
##   - It is related to winning the lottery (which was random)
##   - It is related to ability
##   - It has some "white noise" just so that the model will estimate.
d[ , schooling := instrument_strength * lottery + ability + rnorm(.N, mean=0, sd=1)]
## Create the outcome, which might be earnings. This has the following characteristics:
##   - It is affected by schooling (Yay!)
##   - It is affected by ability (Yay!)
##   - It is affected by family income :|
d[ , earnings := 2 * schooling + ability + family_income +  rnorm(.N, mean=0, sd=1)]
return(d)
}
d <- make_iv_data()
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
d <- make_iv_data(instrument_strength = 0.0)
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
d <- make_iv_data(instrument_strength = 0.0)
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
d <- make_iv_data(instrument_strength = 1.0)
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
second_stage <- d[ , lm(earnings ~ residuals)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = 0.1)
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , residuals := resid(first_stage)]
second_stage <- d[ , lm(earnings ~ residuals)]
summary(second_stage)
biased_estimate <- d[ , lm(earnings ~ schooling)]
biased_estimate <- d[ , lm(earnings ~ schooling)]
summary(biased_estimate)
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 1.0)
biased_estimate <- d[ , lm(earnings ~ schooling)
first_stage <- d[ , lm(schooling ~ lottery)]
d_weak_instrument <- make_iv_data(instrument_strength = 1.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , residuals := resid(first_stage)]
second_stage <- d[ , lm(earnings ~ residuals)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 1.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , residuals := resid(first_stage)]
second_stage <- d[ , lm(earnings ~ residuals)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
second_stage
d_weak_instrument <- make_iv_data(instrument_strength = 2.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , residuals := resid(first_stage)]
second_stage <- d[ , lm(earnings ~ residuals)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 2.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 1.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.1)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.01)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.01)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
first_stage
d_weak_instrument <- make_iv_data(instrument_strength = 0.001)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
second_stage
make_iv_data
d_weak_instrument <- make_iv_data(instrument_strength = 0.0)
biased_estimate <- d[ , lm(earnings ~ schooling)]
first_stage <- d[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.0)
first_stage <- d[ , lm(schooling ~ lottery)]
first_stage
d_weak_instrument <- make_iv_data(instrument_strength = 0.0)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
d_weak_instrument <- make_iv_data(instrument_strength = 0.0)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.10)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 0.20)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = 20)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
d_weak_instrument <- make_iv_data(instrument_strength = .3)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
stargazer::stargazer(
biased_estimate, second_stage,
type = "text"
)
summary(first_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .1)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
N <- 1000
d <- data.table(id=1:N)
d[ , ':='(
tau     = rnorm(.N, mean=0, sd=2),
running = runif(.N, min=-2, max=2),
y0      = runif(.N, min=-1, max=1)) ][ ,
y1     := y0 + tau ][ ,
Y      := ifelse(running > 0, y1, y0)]
ggplot(d) +
aes(x=running, y=Y) +
geom_point() +
stat_smooth(method = 'lm', se=FALSE)
d[ , plot(x=running, y=Y, pch = 19, col=berkeley_blue)]
d[running < 0, lines(lowess(running,Y), lwd=10, col=california_gold)]
d[running > 0, lines(lowess(running,Y), lwd=10, col=california_gold)]
d <- data.table(id=1:N)
d[ , ':='(
running = runif(n=.N, min=0, max=10),
cov1    = rnorm(n=.N)) ][ ,
Y := running * 0.1 - 0.2 * cov1 + 1 * I(running > 5) + rnorm(n=.N)]
d[ , plot(x=running, y=Y, col=berkeley_blue, pch=19)]
d[ , plot(x=running, y=Y, col=berkeley_blue, pch=19)]
d[ , lines(lowess(running, Y), col=california_gold, lwd=10)]
d[running < 5.2 & running > 4.8 , plot(x=running, y=Y, col=berkeley_blue, pch=19)]
d[running < 5 , lines(lowess(running, Y), col=california_gold, lwd=10)]
d[running > 5 , lines(lowess(running, Y), col=california_gold, lwd=10)]
d <- data.frame(running = runif(1000, min = 0, max = 10),
cov1    = rnorm(1000))
d$y <- d$running * 0.1 - .2 * d$cov1 + 1 * I(d$running > 5) +
.4 * d$running * I(d$running > 5) + rnorm(1000)
plot(x = d$running, d$y, pch = 19, col = rgb(0,1,0, .4))
lines(lowess(d$running[d$running < 5], d$y[d$running < 5]))
lines(lowess(d$running[d$running > 5], d$y[d$running > 5]))
make_iv_data <- function(instrument_strength=1.0) {
set.seed(2)
d <- data.table(id = 1:1000)
## These are all independent of one another.
d[ , ':='(
ability       = rnorm(.N, mean=10, sd=1),
family_income = rnorm(.N, mean=20, sd=2),
lottery       = rnorm(.N, mean=10, sd=1) > 10 ## Win if larger than 10
)]
## Create a schooling indicator. This has the following characteristics:
##   - It is related to winning the lottery (which was random)
##   - It is related to ability
##   - It has some "white noise" just so that the model will estimate.
d[ , schooling := instrument_strength * lottery + ability + rnorm(.N, mean=0, sd=1)]
## Create the outcome, which might be earnings. This has the following characteristics:
##   - It is affected by schooling (Yay!)
##   - It is affected by ability (Yay!)
##   - It is affected by family income :|
d[ , earnings := 2 * schooling + ability + family_income +  rnorm(.N, mean=0, sd=1)]
return(d)
}
d <- make_iv_data(instrument_strength = 1.0)
d
print(d)
d <- make_iv_data(instrument_strength = 1.0)
print(d)
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
model_wrong <- d[ , lm(earnings ~ schooling + ability)]
coeftest(model_wrong, vcov. = vcovHC)
model_wrong <- d[ , lm(earnings ~ schooling)]
coeftest(model_wrong, vcov. = vcovHC)
first_stage <- d[ , lm(schooling ~ lottery)]
summary(first_stage)
d[ , schooling_hat := predict(first_stage)]
predict(first_stage)
summary(first_stage)
d[ , .(schooling_hat, lottery)]
d[ , mean(schooling_hat), keyby = .(lottery)]
d
d[ , .(schooling_hat, lottery)]
d[ , .(schooling_hat, lottery, ability)]
ggplot(d) +
aes(y = ability, x = schooling_hat) +
geom_point()
ggplot(d) +
aes(y = ability, x = schooling_hat) +
geom_jitter()
?geom_jitter()
ggplot(d) +
aes(y = ability, x = schooling_hat) +
geom_jitter(height=0)
ggplot(d) +
aes(x = ability, fill = as.factor(schooling_hat)) +
geom_density()
ggplot(d) +
aes(x = ability, fill = as.factor(schooling_hat)) +
geom_density(alpha = 0.5)
second_stage <- d[ , lm(earnings ~ schooling_hat)]
coeftest(second_stage, vcov. = vcovHC)
d_weak_instrument <- make_iv_data(instrument_strength = .1)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .1)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .1)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .2)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .3)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = .4)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = 1.0)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = 20)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = 0)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -0.1)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -0.2)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -20)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -.2)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -.2)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -.2)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -.6)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
d_weak_instrument <- make_iv_data(instrument_strength = -.3)
biased_estimate <- d_weak_instrument[ , lm(earnings ~ schooling)]
# summary(biased_estimate)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
d_weak_instrument[ , schooling_hat := predict(first_stage)]
second_stage <- d_weak_instrument[ , lm(earnings ~ schooling_hat)]
summary(second_stage)
first_stage <- d_weak_instrument[ , lm(schooling ~ lottery)]
summary(first_stage)
d <- data.table(id=1:N)
d[ , ':='(
running = runif(n=.N, min=0, max=10),
cov1    = rnorm(n=.N)) ][ ,
Y := running * 0.1 - 0.2 * cov1 + 1 * I(running > 5) + rnorm(n=.N)]
d[ , plot(x=running, y=Y, col=berkeley_blue, pch=19)]
d[, plot(x=running, y=Y, col=berkeley_blue, pch=19)]
d[running < 5 , lines(lowess(running, Y), col=california_gold, lwd=10)]
d[running > 5 , lines(lowess(running, Y), col=california_gold, lwd=10)]
